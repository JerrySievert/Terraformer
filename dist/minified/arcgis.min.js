!function(a,b){"object"==typeof module&&"object"==typeof module.exports&&(exports=module.exports=b()),"function"==typeof define&&define.amd&&define(["terraformer/terraformer"],b),"object"==typeof a.navigator&&("undefined"==typeof a.Terraformer&&(a.Terraformer={}),a.Terraformer.ArcGIS=b())}(this,function(){function a(a){var b,c=0,d=0,e=a.length,f=a[d];for(d;e-1>d;d++)b=a[d+1],c+=(b[0]-f[0])*(b[1]+f[1]),f=b;return c>=0}function b(b){var c=[],d=b.shift();a(d)||d.reverse(),c.push(d);for(var e=0;e<b.length;e++){var f=b[e];a(f)&&d.reverse(),c.push(b[e])}return c}function c(a){for(var c=[],d=0;d<a.length;d++){for(var e=b(a[d]),f=e.length-1;f>=0;f--){var g=e[f];c.push(g)}c.push()}return c}function d(a,b){var c=h.Tools.arrayIntersectsArray(a,b),d=h.Tools.coordinatesContainPoint(a,b[0]);return!c&&d?!0:!1}function e(b){for(var c=[],e=[],f=0;f<b.length;f++){var g=b[f];if(a(g)){var h=[g];c.push(h)}else e.push(g)}for(;e.length;){for(var i=e.pop(),j=!1,k=c.length-1;k>=0;k--){var l=c[k][0];if(d(l,i)){c[k].push(i),j=!0;break}}j||c.push([i.reverse()])}return 1===c.length?{type:"Polygon",coordinates:c[0]}:{type:"MultiPolygon",coordinates:c}}function f(a){var b={};a.x&&a.y&&(b.type="Point",b.coordinates=[a.x,a.y]),a.points&&(b.type="MultiPoint",b.coordinates=a.points),a.paths&&(1===a.paths.length?(b.type="LineString",b.coordinates=a.paths[0]):(b.type="MultiLineString",b.coordinates=a.paths)),a.rings&&(b=e(a.rings)),a.attributes&&a.geometry&&(b.type="Feature",b.geometry=f(a.geometry),b.properties=a.attributes);var c=a.geometry?a.geometry.spatialReference:a.spatialReference;return c&&102100===c.wkid&&(b=h.toGeographic(b)),new h.Primitive(b)}function g(a){var d,e={wkid:4326},f={};switch(a.type){case"Point":f.x=a.coordinates[0],f.y=a.coordinates[1],f.spatialReference=e;break;case"MultiPoint":f.points=a.coordinates,f.spatialReference=e;break;case"LineString":f.paths=[a.coordinates],f.spatialReference=e;break;case"MultiLineString":f.paths=a.coordinates,f.spatialReference=e;break;case"Polygon":f.rings=b(a.coordinates),f.spatialReference=e;break;case"MultiPolygon":f.rings=c(a.coordinates),f.spatialReference=e;break;case"Feature":f.geometry=g(a.geometry),f.attributes=a.properties;break;case"FeatureCollection":for(f=[],d=0;d<a.features.length;d++)f.push(g(a.features[d]));break;case"GeometryCollection":for(f=[],d=0;d<a.geometries.length;d++)f.push(g(a.geometries[d]))}return f}var h,i={};return"object"==typeof this.navigator&&(h=this.Terraformer),"object"==typeof module&&"object"==typeof module.exports&&(h=require("terraformer")),arguments[0]&&"function"==typeof define&&define.amd&&(h=arguments[0]),i.parse=f,i.convert=g,i});