!function(a,b){"function"==typeof define&&define.amd&&define([],b),"object"==typeof a.navigator&&("undefined"==typeof a.Terraformer&&(a.Terraformer={}),"undefined"==typeof a.Terraformer.Store&&(a.Terraformer.Store={}),a.Terraformer.Store.LocalStorage=b().LocalStorage)}(this,function(){function a(){var a=arguments[0]||{};this._key=a.key||"_terraformer"}var b={};return arguments[0]&&"function"==typeof define&&define.amd&&(this.Terraformer=arguments[0]),a.prototype.add=function(a,b){if("FeatureCollection"===a.type)for(var c=0;c<a.features.length;c++)this.set(a.features[c]);else this.set(a);return b.resolve(a),b},a.prototype.key=function(a){return this._key+"_"+a},a.prototype.remove=function(a,b){return localStorage.removeItem(this.key(a)),b.resolve(),b},a.prototype.get=function(a,b){return b.resolve(JSON.parse(localStorage.getItem(this.key(a)))),b},a.prototype.set=function(a){localStorage.setItem(this.key(a.id),JSON.stringify(a))},a.prototype.update=function(a,b){return this.set(a),b.resolve(a),b},a.prototype.toJSON=function(){var a=new RegExp("^"+this._key),b={};for(var c in localStorage)c.match(a)&&(b[c]=localStorage[c]);return b},a.prototype.serialize=function(a){var b=[],c=new this.deferred;a&&c.then(function(b){a(null,b)},function(b){a(b,null)});for(var d in localStorage)d.match(this.key)&&b.push(localStorage.getItem(d));c.resolve(JSON.stringify(b))},a.prototype.deserialize=function(a,b){var c=JSON.parse(a),d=new this.deferred;b&&d.then(function(a){b(null,a)},function(a){b(a,null)});for(var e=c.length-1;e>=0;e--)this.set(c[e]);return d.resolve(this),d},b.LocalStorage=a,b});