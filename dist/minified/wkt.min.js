!function(a,b){"object"==typeof module&&"object"==typeof module.exports&&(exports=module.exports=b()),"function"==typeof define&&define.amd&&define(["terraformer/terraformer"],b),"object"==typeof navigator&&("undefined"==typeof a.Terraformer&&(a.Terraformer={}),a.Terraformer.WKT=b())}(this,function(){function a(a){for(var b=[],c="",d=0;d<a.length;d++)b.push(a[d].join(" "));return c+="("+b.join(", ")+")"}function b(a){var b="POINT ";return void 0===a.coordinates||0===a.coordinates.length?b+="EMPTY":(3===a.coordinates.length?b+=a.properties.m===!0?"M ":"Z ":4===a.coordinates.length&&(b+="ZM "),b+="("+a.coordinates.join(" ")+")")}function c(b){var c="LINESTRING ";return void 0===b.coordinates||0===b.coordinates.length||0===b.coordinates[0].length?c+="EMPTY":(3===b.coordinates[0][0].length?c+=b.properties.m===!0?"M ":"Z ":4===b.coordinates[0][0].length&&(c+="ZM "),c+=a(b.coordinates))}function d(b){var c="POLYGON ";if(void 0===b.coordinates||0===b.coordinates.length||0===b.coordinates[0].length)return c+="EMPTY";3===b.coordinates[0][0].length?c+=b.properties.m===!0?"M ":"Z ":4===b.coordinates[0][0].length&&(c+="ZM "),c+="(";for(var d=[],e=0;e<b.coordinates.length;e++)d.push(a(b.coordinates[e]));return c+=d.join(", "),c+=")"}function e(b){var c="MULTIPOINT ";return void 0===b.coordinates||0===b.coordinates.length||0===b.coordinates[0].length?c+="EMPTY":(3===b.coordinates[0][0].length?c+=b.properties.m===!0?"M ":"Z ":4===b.coordinates[0][0].length&&(c+="ZM "),c+=a(b.coordinates))}function f(b){var c="MULTILINESTRING ";if(void 0===b.coordinates||0===b.coordinates.length||0===b.coordinates[0].length)return c+="EMPTY";3===b.coordinates[0][0].length?c+=b.properties.m===!0?"M ":"Z ":4===b.coordinates[0][0].length&&(c+="ZM "),c+="(";for(var d=[],e=0;e<b.coordinates.length;e++)d.push(a(b.coordinates[e]));return c+=d.join(", "),c+=")"}function g(b){var c="MULTIPOLYGON ";if(void 0===b.coordinates||0===b.coordinates.length||0===b.coordinates[0].length)return c+="EMPTY";3===b.coordinates[0][0][0].length?c+=b.properties.m===!0?"M ":"Z ":4===b.coordinates[0][0][0].length&&(c+="ZM "),c+="(";for(var d=[],e=0;e<b.coordinates.length;e++){for(var f="(",g=[],h=0;h<b.coordinates[e].length;h++)g.push(a(b.coordinates[e][h]));f+=g.join(", "),f+=")",d.push(f)}return c+=d.join(", "),c+=")"}function h(a){switch(a.type){case"Point":return b(a);case"LineString":return c(a);case"Polygon":return d(a);case"MultiPoint":return e(a);case"MultiLineString":return f(a);case"MultiPolygon":return g(a);default:throw Error("Unknown Type: "+a.type)}}function i(a){this.data=[a],this.type="PointArray"}function j(a){this.data=a,this.type="Ring"}function k(a){this.data=[a],this.type="RingList"}function l(a){this.data=[a],this.type="PolygonList"}function m(a){var b;try{b=p.parse(a)}catch(c){throw console.dir(c),Error("Unable to parse",c)}return n.Primitive(b)}var n,o={};"object"==typeof this.navigator&&(n=this.Terraformer),"object"==typeof module&&"object"==typeof module.exports&&(n=require("terraformer")),arguments[0]&&"function"==typeof define&&define.amd&&(n=arguments[0]);var p=function(){function a(){this.yy={}}var b={trace:function(){},yy:{},symbols_:{error:2,expressions:3,point:4,EOF:5,linestring:6,polygon:7,multipoint:8,multilinestring:9,multipolygon:10,coordinate:11,DOUBLE_TOK:12,ptarray:13,COMMA:14,ring_list:15,ring:16,"(":17,")":18,POINT:19,Z:20,M:21,EMPTY:22,point_untagged:23,polygon_list:24,polygon_untagged:25,point_list:26,LINESTRING:27,POLYGON:28,MULTIPOINT:29,MULTILINESTRING:30,MULTIPOLYGON:31,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",12:"DOUBLE_TOK",14:"COMMA",17:"(",18:")",19:"POINT",20:"Z",21:"M",22:"EMPTY",27:"LINESTRING",28:"POLYGON",29:"MULTIPOINT",30:"MULTILINESTRING",31:"MULTIPOLYGON"},productions_:[0,[3,2],[3,2],[3,2],[3,2],[3,2],[3,2],[11,2],[11,3],[11,4],[13,3],[13,1],[15,3],[15,1],[16,3],[4,4],[4,5],[4,6],[4,5],[4,2],[23,1],[23,3],[24,3],[24,1],[25,3],[26,3],[26,1],[6,4],[6,5],[6,5],[6,6],[6,2],[7,4],[7,5],[7,5],[7,6],[7,2],[8,4],[8,5],[8,5],[8,6],[8,2],[9,4],[9,5],[9,5],[9,6],[9,2],[10,4],[10,5],[10,5],[10,6],[10,2]],performAction:function(a,b,c,d,e,f){var g=f.length-1;switch(e){case 1:return f[g-1];case 2:return f[g-1];case 3:return f[g-1];case 4:return f[g-1];case 5:return f[g-1];case 6:return f[g-1];case 7:this.$=new i([Number(f[g-1]),Number(f[g])]);break;case 8:this.$=new i([Number(f[g-2]),Number(f[g-1]),Number(f[g])]);break;case 9:this.$=new i([Number(f[g-3]),Number(f[g-2]),Number(f[g-1]),Number(f[g])]);break;case 10:this.$=f[g-2].addPoint(f[g]);break;case 11:this.$=f[g];break;case 12:this.$=f[g-2].addRing(f[g]);break;case 13:this.$=new k(f[g]);break;case 14:this.$=new j(f[g-1]);break;case 15:this.$={type:"Point",coordinates:f[g-1].data[0]};break;case 16:this.$={type:"Point",coordinates:f[g-2].data[0],properties:{z:!0}};break;case 17:this.$={type:"Point",coordinates:f[g-3].data[0],properties:{z:!0,m:!0}};break;case 18:this.$={type:"Point",coordinates:f[g-2].data[0],properties:{m:!0}};break;case 19:this.$={type:"Point",coordinates:[]};break;case 20:this.$=f[g];break;case 21:this.$=f[g-1];break;case 22:this.$=f[g-2].addPolygon(f[g]);break;case 23:this.$=new l(f[g]);break;case 24:this.$=f[g-1];break;case 25:this.$=f[g-2].addPoint(f[g]);break;case 26:this.$=f[g];break;case 27:this.$={type:"LineString",coordinates:f[g-1].data};break;case 28:this.$={type:"LineString",coordinates:f[g-2].data,properties:{z:!0}};break;case 29:this.$={type:"LineString",coordinates:f[g-2].data,properties:{m:!0}};break;case 30:this.$={type:"LineString",coordinates:f[g-3].data,properties:{z:!0,m:!0}};break;case 31:this.$={type:"LineString",coordinates:[]};break;case 32:this.$={type:"Polygon",coordinates:f[g-1].toJSON()};break;case 33:this.$={type:"Polygon",coordinates:f[g-2].toJSON(),properties:{z:!0}};break;case 34:this.$={type:"Polygon",coordinates:f[g-2].toJSON(),properties:{m:!0}};break;case 35:this.$={type:"Polygon",coordinates:f[g-3].toJSON(),properties:{z:!0,m:!0}};break;case 36:this.$={type:"Polygon",coordinates:[]};break;case 37:this.$={type:"MultiPoint",coordinates:f[g-1].data};break;case 38:this.$={type:"MultiPoint",coordinates:f[g-2].data,properties:{z:!0}};break;case 39:this.$={type:"MultiPoint",coordinates:f[g-2].data,properties:{m:!0}};break;case 40:this.$={type:"MultiPoint",coordinates:f[g-3].data,properties:{z:!0,m:!0}};break;case 41:this.$={type:"MultiPoint",coordinates:[]};break;case 42:this.$={type:"MultiLineString",coordinates:f[g-1].toJSON()};break;case 43:this.$={type:"MultiLineString",coordinates:f[g-2].toJSON(),properties:{z:!0}};break;case 44:this.$={type:"MultiLineString",coordinates:f[g-2].toJSON(),properties:{m:!0}};break;case 45:this.$={type:"MultiLineString",coordinates:f[g-3].toJSON(),properties:{z:!0,m:!0}};break;case 46:this.$={type:"MultiLineString",coordinates:[]};break;case 47:this.$={type:"MultiPolygon",coordinates:f[g-1].toJSON()};break;case 48:this.$={type:"MultiPolygon",coordinates:f[g-2].toJSON(),properties:{z:!0}};break;case 49:this.$={type:"MultiPolygon",coordinates:f[g-2].toJSON(),properties:{m:!0}};break;case 50:this.$={type:"MultiPolygon",coordinates:f[g-3].toJSON(),properties:{z:!0,m:!0}};break;case 51:this.$={type:"MultiPolygon",coordinates:[]}}},table:[{3:1,4:2,6:3,7:4,8:5,9:6,10:7,19:[1,8],27:[1,9],28:[1,10],29:[1,11],30:[1,12],31:[1,13]},{1:[3]},{5:[1,14]},{5:[1,15]},{5:[1,16]},{5:[1,17]},{5:[1,18]},{5:[1,19]},{17:[1,20],20:[1,21],21:[1,22],22:[1,23]},{17:[1,24],20:[1,25],21:[1,26],22:[1,27]},{17:[1,28],20:[1,29],21:[1,30],22:[1,31]},{17:[1,32],20:[1,33],21:[1,34],22:[1,35]},{17:[1,36],20:[1,37],21:[1,38],22:[1,39]},{17:[1,40],20:[1,41],21:[1,42],22:[1,43]},{1:[2,1]},{1:[2,2]},{1:[2,3]},{1:[2,4]},{1:[2,5]},{1:[2,6]},{11:45,12:[1,46],13:44},{17:[1,47],21:[1,48]},{17:[1,49]},{5:[2,19]},{11:52,12:[1,46],17:[1,53],23:51,26:50},{17:[1,54],21:[1,55]},{17:[1,56]},{5:[2,31]},{15:57,16:58,17:[1,59]},{17:[1,60],21:[1,61]},{17:[1,62]},{5:[2,36]},{11:52,12:[1,46],17:[1,53],23:51,26:63},{17:[1,64],21:[1,65]},{17:[1,66]},{5:[2,41]},{15:67,16:58,17:[1,59]},{17:[1,68],21:[1,69]},{17:[1,70]},{5:[2,46]},{17:[1,73],24:71,25:72},{17:[1,74],21:[1,75]},{17:[1,76]},{5:[2,51]},{14:[1,78],18:[1,77]},{14:[2,11],18:[2,11]},{12:[1,79]},{11:45,12:[1,46],13:80},{17:[1,81]},{11:45,12:[1,46],13:82},{14:[1,84],18:[1,83]},{14:[2,26],18:[2,26]},{14:[2,20],18:[2,20]},{11:85,12:[1,46]},{11:52,12:[1,46],17:[1,53],23:51,26:86},{17:[1,87]},{11:52,12:[1,46],17:[1,53],23:51,26:88},{14:[1,90],18:[1,89]},{14:[2,13],18:[2,13]},{11:45,12:[1,46],13:91},{15:92,16:58,17:[1,59]},{17:[1,93]},{15:94,16:58,17:[1,59]},{14:[1,84],18:[1,95]},{11:52,12:[1,46],17:[1,53],23:51,26:96},{17:[1,97]},{11:52,12:[1,46],17:[1,53],23:51,26:98},{14:[1,90],18:[1,99]},{15:100,16:58,17:[1,59]},{17:[1,101]},{15:102,16:58,17:[1,59]},{14:[1,104],18:[1,103]},{14:[2,23],18:[2,23]},{15:105,16:58,17:[1,59]},{17:[1,73],24:106,25:72},{17:[1,107]},{17:[1,73],24:108,25:72},{5:[2,15]},{11:109,12:[1,46]},{12:[1,110],14:[2,7],18:[2,7]},{14:[1,78],18:[1,111]},{11:45,12:[1,46],13:112},{14:[1,78],18:[1,113]},{5:[2,27]},{11:52,12:[1,46],17:[1,53],23:114},{18:[1,115]},{14:[1,84],18:[1,116]},{11:52,12:[1,46],17:[1,53],23:51,26:117},{14:[1,84],18:[1,118]},{5:[2,32]},{16:119,17:[1,59]},{14:[1,78],18:[1,120]},{14:[1,90],18:[1,121]},{15:122,16:58,17:[1,59]},{14:[1,90],18:[1,123]},{5:[2,37]},{14:[1,84],18:[1,124]},{11:52,12:[1,46],17:[1,53],23:51,26:125},{14:[1,84],18:[1,126]},{5:[2,42]},{14:[1,90],18:[1,127]},{15:128,16:58,17:[1,59]},{14:[1,90],18:[1,129]},{5:[2,47]},{17:[1,73],25:130},{14:[1,90],18:[1,131]},{14:[1,104],18:[1,132]},{17:[1,73],24:133,25:72},{14:[1,104],18:[1,134]},{14:[2,10],18:[2,10]},{12:[1,135],14:[2,8],18:[2,8]},{5:[2,16]},{14:[1,78],18:[1,136]},{5:[2,18]},{14:[2,25],18:[2,25]},{14:[2,21],18:[2,21]},{5:[2,28]},{14:[1,84],18:[1,137]},{5:[2,29]},{14:[2,12],18:[2,12]},{14:[2,14],18:[2,14]},{5:[2,33]},{14:[1,90],18:[1,138]},{5:[2,34]},{5:[2,38]},{14:[1,84],18:[1,139]},{5:[2,39]},{5:[2,43]},{14:[1,90],18:[1,140]},{5:[2,44]},{14:[2,22],18:[2,22]},{14:[2,24],18:[2,24]},{5:[2,48]},{14:[1,104],18:[1,141]},{5:[2,49]},{14:[2,9],18:[2,9]},{5:[2,17]},{5:[2,30]},{5:[2,35]},{5:[2,40]},{5:[2,45]},{5:[2,50]}],defaultActions:{14:[2,1],15:[2,2],16:[2,3],17:[2,4],18:[2,5],19:[2,6],23:[2,19],27:[2,31],31:[2,36],35:[2,41],39:[2,46],43:[2,51],77:[2,15],83:[2,27],89:[2,32],95:[2,37],99:[2,42],103:[2,47],111:[2,16],113:[2,18],116:[2,28],118:[2,29],121:[2,33],123:[2,34],124:[2,38],126:[2,39],127:[2,43],129:[2,44],132:[2,48],134:[2,49],136:[2,17],137:[2,30],138:[2,35],139:[2,40],140:[2,45],141:[2,50]},parseError:function(a){throw new Error(a)},parse:function(a){function b(){var a;return a=c.lexer.lex()||1,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;f.push(l);var m=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var n,o,p,q,r,s,t,u,v,w={};;){if(p=d[d.length-1],this.defaultActions[p]?q=this.defaultActions[p]:((null===n||"undefined"==typeof n)&&(n=b()),q=g[p]&&g[p][n]),"undefined"==typeof q||!q.length||!q[0]){var x="";if(!k){v=[];for(s in g[p])this.terminals_[s]&&s>2&&v.push("'"+this.terminals_[s]+"'");x=this.lexer.showPosition?"Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(i+1)+": Unexpected "+(1==n?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[n]||n,line:this.lexer.yylineno,loc:l,expected:v})}}if(q[0]instanceof Array&&q.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+n);switch(q[0]){case 1:d.push(n),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(q[1]),n=null,o?(n=o,o=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,l=this.lexer.yylloc,k>0&&k--);break;case 2:if(t=this.productions_[q[1]][1],w.$=e[e.length-t],w._$={first_line:f[f.length-(t||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(t||1)].first_column,last_column:f[f.length-1].last_column},m&&(w._$.range=[f[f.length-(t||1)].range[0],f[f.length-1].range[1]]),r=this.performAction.call(w,h,j,i,this.yy,q[1],e,f),"undefined"!=typeof r)return r;t&&(d=d.slice(0,2*-1*t),e=e.slice(0,-1*t),f=f.slice(0,-1*t)),d.push(this.productions_[q[1]][0]),e.push(w.$),f.push(w._$),u=g[d[d.length-2]][d[d.length-1]],d.push(u);break;case 3:return!0}}return!0}},c=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b-1),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this},more:function(){return this._more=!0,this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d,e;this._more||(this.yytext="",this.match="");for(var f=this._currentRules(),g=0;g<f.length&&(c=this._input.match(this.rules[f[g]]),!c||b&&!(c[0].length>b[0].length)||(b=c,d=g,this.options.flex));g++);return b?(e=b[0].match(/(?:\r\n?|\n).*/g),e&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,f[d],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),a?a:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.options={},a.performAction=function(a,b,c,d){switch(c){case 0:break;case 1:return 17;case 2:return 18;case 3:return 12;case 4:return 19;case 5:return 27;case 6:return 28;case 7:return 29;case 8:return 30;case 9:return 31;case 10:return 14;case 11:return 22;case 12:return 21;case 13:return 20;case 14:return 5;case 15:return"INVALID"}},a.rules=[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:-?[0-9]+(\.[0-9]+)?)/,/^(?:POINT\b)/,/^(?:LINESTRING\b)/,/^(?:POLYGON\b)/,/^(?:MULTIPOINT\b)/,/^(?:MULTILINESTRING\b)/,/^(?:MULTIPOLYGON\b)/,/^(?:,)/,/^(?:EMPTY\b)/,/^(?:M\b)/,/^(?:Z\b)/,/^(?:$)/,/^(?:.)/],a.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],inclusive:!0}},a}();return b.lexer=c,a.prototype=b,b.Parser=a,new a}();return o.convert=h,i.prototype.addPoint=function(a){return"PointArray"===a.type?this.data=this.data.concat(a.data):this.data.push(a),this},i.prototype.toJSON=function(){return this.data},j.prototype.toJSON=function(){for(var a=[],b=0;b<this.data.data.length;b++)a.push(this.data.data[b]);return a},k.prototype.addRing=function(a){return this.data.push(a),this},k.prototype.toJSON=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(this.data[b].toJSON());return 1===a.length?a:a},l.prototype.addPolygon=function(a){return this.data.push(a),this},l.prototype.toJSON=function(){for(var a=[],b=0;b<this.data.length;b++)a=a.concat([this.data[b].toJSON()]);return 1===a.length?a:a},o.parser=p,o.Parser=p.Parser,o.parse=m,o});